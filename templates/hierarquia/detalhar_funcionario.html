{% extends 'base.html' %} {# Ou 'hierarquia/base.html' #}
{% load static %}

{% block title %}{{ funcionario.ra_nome }} Detalhes - Funcionário{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/detalhar_funcionario.css' %}">
{% endblock extra_css %}

{% block content %}
<div class="container">
    <div class="header">
        {# CORRIGIDO: de .nome para .ra_nome #}
        <h2>{{ funcionario.ra_nome }}</h2>
    </div>

    <div class="card">
        <h3>Informações Pessoais</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">CPF</div>
                {# CORRIGIDO: de .cpf para .ra_cpf #}
                <div class="info-value">{{ funcionario.ra_cpf }}</div>
            </div>
            
            {% comment %} {% endcomment %}
            {% if funcionario.ra_data_nasc %}
            <div class="info-item">
                <div class="info-label">Data de Nascimento</div>
                {# CORRIGIDO: Formato de data brasileiro a partir do texto "YYYY-MM-DD..." #}
                <div class="info-value">{{ funcionario.ra_data_nasc|slice:"8:10" }}/{{ funcionario.ra_data_nasc|slice:"5:7" }}/{{ funcionario.ra_data_nasc|slice:"0:4" }}</div>
            </div>
            {% endif %}
            
            <div class="info-item">
                <div class="info-label">Data de Admissão</div>
                {# CORRIGIDO: de data_admissao para ra_data_admis e formato de data #}
                <div class="info-value">{{ funcionario.ra_data_admis|slice:"8:10" }}/{{ funcionario.ra_data_admis|slice:"5:7" }}/{{ funcionario.ra_data_admis|slice:"0:4" }}</div>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>Informações Profissionais</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">Cargo</div>
                <div class="info-value">{{ funcionario.cargo.nome }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Nível Hierárquico</div>
                <div class="info-value">Nível {{ funcionario.cargo.nivel }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">Setor</div>
                <div class="info-value">
                    {% if funcionario.setor_primario %}
                        {{ funcionario.setor_primario.nome }}
                    {% else %}
                        <span style="color: #999;">Nenhum</span>
                    {% endif %}
                </div>
            </div>
            
            {% if funcionario.setores_responsaveis.exists %}
            <div class="info-item" style="grid-column: 1 / -1;"> {# Ocupa largura total #}
                <div class="info-label">Setores Responsáveis</div>
                <div class="info-value">
                    {% for setor_resp in funcionario.setores_responsaveis.all %}
                        {{ setor_resp.nome }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% comment %} {% endcomment %}
        </div>
    </div>

    {# Bloco Superiores - Corrigido .nome para .ra_nome #}
    <div class="card">
        <h3>Superiores Hierárquicos</h3>
        <div class="info-grid">
            {% for superior in superiores %}
            <div class="info-item">
                <div class="info-label">{{ superior.cargo.nome }}</div>
                <div class="info-value">
                    <a href="{% url 'detalhar_funcionario' superior.id %}">
                        {{ superior.ra_nome }} →
                    </a>
                </div>
            </div>
            {% empty %}
            <div class="info-item empty-state" style="grid-column: 1 / -1;">
                <p>Nenhum superior hierárquico</p>
            </div>
            {% endfor %}
        </div>
    </div>

    {# Bloco Subordinados - Corrigido .nome para .ra_nome #}
    <div class="card">
        <h3>Subordinados</h3>
        <div class="info-grid">
            {% for subordinado in subordinados %}
            <div class="info-item">
                <div class="info-label">{{ subordinado.cargo.nome }}</div>
                <div class="info-value">
                    <a href="{% url 'detalhar_funcionario' subordinado.id %}">
                        {{ subordinado.ra_nome }} →
                    </a>
                </div>
            </div>
            {% empty %}
             <div class="info-item empty-state" style="grid-column: 1 / -1;">
                <p>Nenhum subordinado</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <a href="{% url 'listar_setores_funcionarios' %}" class="btn">← Voltar à Lista</a>
</div>
{% endblock content %}