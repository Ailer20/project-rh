{% extends 'base.html' %}
{% load static %}

{% block title %}Funcionários - Setor {{ setor.nome }}{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/listar_funcionarios.css' %}">
{% endblock extra_css %}

{% block content %}
<div class="container">
    
    <div class="header-bar">
        <div class="header-content">
            <h2>Setor: {{ setor.nome }}</h2>
            <p>Lista de funcionários ativos no setor.</p>
        </div>
        <div class="header-actions">
            {% if perms.hierarquia.add_funcionario %}
                <a href="{% url 'cadastrar_funcionario' %}?setor_id={{ setor.id }}" class="btn-primary">
                    <i class="fas fa-plus"></i> Novo Funcionário
                </a>
            {% endif %}
            <a href="{% url 'listar_setores_funcionarios' %}" class="btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar para Setores
            </a>
        </div>
    </div>

    <div class="search-box">
        <form method="GET">
            <i class="fas fa-search"></i>
            <input type="text" name="busca" placeholder="Buscar por nome neste setor..." value="{{ busca }}">
            <button type="submit">Buscar</button>
        </form>
    </div>

    {% if funcionarios_list %}
    <div class="profile-grid">
        {% for item in funcionarios_list %}
        {% with func=item.obj %} {# <--- Pega o objeto 'func' de dentro do item #}
        <div class="profile-card">
            
            <div class="profile-card-header">
                <div class="profile-avatar">
                    <span>{{ func.ra_nome|make_list|first|first }}{{ func.ra_nome|make_list|last|first }}</span>
                </div>
                <div class="profile-info">
                    <h3 class="profile-name">{{ func.ra_nome|title }}</h3>
                    <p class="profile-cargo">{{ func.cargo.nome|title }}</p>
                </div>
            </div>
            
            <div class="profile-card-body">
                <div class="info-item">
                    <i class="fas fa-id-card-alt"></i>
                    <span><strong>CPF:</strong> {{ func.ra_cpf|default:"Não informado" }}</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span><strong>Admissão:</strong> {{ item.data_admissao_formatada }}</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-building"></i>
                    <span><strong>Centro Custo:</strong> {{ func.ra_centro_custo|default:"N/A" }}</span>
                </div>
            </div>
            
            <div class="profile-card-footer">
                <a href="{% url 'detalhar_funcionario' func.id %}" class="btn-secondary-outline">
                    Ver Detalhes
                </a>
            </div>
        </div>
        {% endwith %}
        {% endfor %}
    </div>
    
    {% else %}
    <div class="card empty-state">
        <div class="empty-state-icon"><i class="fas fa-user-times"></i></div>
        <h3>Nenhum funcionário encontrado</h3>
        <p>Não há funcionários neste setor{% if busca %} com o nome "{{ busca }}"{% endif %}.</p>
    </div>
    {% endif %}

</div>
{% endblock content %}